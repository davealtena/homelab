# yaml-language-server: $schema=https://raw.githubusercontent.com/budimanjojo/talhelper/master/pkg/config/schemas/talconfig.json
---
# renovate: datasource=docker depName=ghcr.io/siderolabs/installer
talosVersion: v1.12.4
# renovate: datasource=docker depName=ghcr.io/siderolabs/kubelet
kubernetesVersion: v1.35.1

clusterName: "valhalla"
endpoint: https://192.168.1.101:6443
clusterPodNets:
  - "10.69.0.0/16"
clusterSvcNets:
  - "10.96.0.0/16"
additionalApiServerCertSans: &sans
  - "192.168.1.101"
  - 127.0.0.1 # KubePrism
additionalMachineCertSans: *sans

# Disable built-in Flannel to use Cilium
cniConfig:
  name: none

nodes:
  # Baldur - Toshiba 256GB OS disk
  - hostname: "baldur"
    ipAddress: "192.168.1.105"
    installDiskSelector:
      size: "<= 512GB"
      model: "*TOSHIBA*"
    talosImageURL: factory.talos.dev/installer/4b3cd373a192c8469e859b7a0cfbed3ecc3577c4a2d346a37b0aeff9cd17cdb0
    controlPlane: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: "b8:85:84:a2:8a:4b"
        dhcp: false
        addresses:
          - "192.168.1.105/24"
        routes:
          - network: 0.0.0.0/0
            gateway: "192.168.1.1"
        mtu: 1500
        vlans:
          - vlanId: 20
            dhcp: false
        vip:
          ip: "192.168.1.101"
  # Freya - Toshiba 256GB OS disk: naa.500080dc00d6459a
  - hostname: "freya"
    ipAddress: "192.168.1.106"
    installDiskSelector:
      wwid: "naa.500080dc00d6459a"
    talosImageURL: factory.talos.dev/installer/4b3cd373a192c8469e859b7a0cfbed3ecc3577c4a2d346a37b0aeff9cd17cdb0
    controlPlane: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: "54:bf:64:7d:72:d3"
        dhcp: false
        addresses:
          - "192.168.1.106/24"
        routes:
          - network: 0.0.0.0/0
            gateway: "192.168.1.1"
        mtu: 1500
        vlans:
          - vlanId: 20
            dhcp: false
        vip:
          ip: "192.168.1.101"
  # Heimdall - Toshiba 256GB OS disk: naa.500080dc00f48477
  - hostname: "heimdall"
    ipAddress: "192.168.1.107"
    installDiskSelector:
      wwid: "naa.500080dc00f48477"
    talosImageURL: factory.talos.dev/installer/4b3cd373a192c8469e859b7a0cfbed3ecc3577c4a2d346a37b0aeff9cd17cdb0
    controlPlane: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: "b8:85:84:a8:e7:55"
        dhcp: false
        addresses:
          - "192.168.1.107/24"
        routes:
          - network: 0.0.0.0/0
            gateway: "192.168.1.1"
        mtu: 1500
        vlans:
          - vlanId: 20
            dhcp: false
        vip:
          ip: "192.168.1.101"

# Global patches
patches:
  - "@./patches/global/machine-files.yaml"
  - "@./patches/global/machine-features.yaml"
  - "@./patches/global/machine-network.yaml"
  - "@./patches/global/machine-kubelet.yaml"
  - "@./patches/global/machine-openebs-local.yaml"
  - "@./patches/global/machine-sysctl.yaml"
  - "@./patches/global/machine-time.yaml"

# Controller patches
controlPlane:
  patches:
    - "@./patches/controller/cluster.yaml"
    - "@./patches/controller/disable-admission-controller.yaml"
